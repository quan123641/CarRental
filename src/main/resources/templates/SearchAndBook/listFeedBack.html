<!DOCTYPE html>
<html lang="en" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{shared/layouts/layout}">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/home.css}" />
    <script type="module" th:src="@{/js/home/home.js}"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>

    <style>
        .star {
            color: black;
        }

        .star.filled {
            color: gold;
        }
    </style>
</head>

<body>
    <section layout:fragment="content" class="text-center">
        <div class="flex flex-col">
            <div class="bg-gray-100 h-full w-screen">
                <div class="w-full h-12 bg-white text-black flex items-center pl-16">
                    <a href="/">Home</a> > My Report
                </div>
            </div>
            <div class="bg-white h-auto w-screen flex flex-col px-4 py-4">
                <div class="font-bold text-6xl text-left">My Feedback</div>
                <div class="font-bold text-3xl text-left mt-5">Average Ratings</div>


                <div class="text-center font-bold text-4xl mt-5" id="rating-value" th:text="${totalRating}">1.25</div>
                <div class="text-center text-4xl" id="stars">
                    <span class="star" data-value="1">★</span>
                    <span class="star" data-value="2">★</span>
                    <span class="star" data-value="3">★</span>
                    <span class="star" data-value="4">★</span>
                    <span class="star" data-value="5">★</span>
                </div>


            </div>
            <div class="text-left ml-10 mr-10">
                <div class="text-bold text-3xl md-4 m-3">Details</div>
                <div class="flex justify-between items-center m-3 p-2 space-x-2">
                    <button class=" bg-blue-300 border border-black px-5 py-6 rounded"
                        onclick="window.location.href='/listFeedBack?page=0&size=' + document.getElementById('pageSize').value;">
                        All (200)
                    </button>
                    <button class="bg-blue-300 border border-black px-5 py-6 rounded"
                        onclick="window.location.href='/listFeedBack?page=0&size=' + document.getElementById('pageSize').value + '&star=5'">
                        5 Star (100)
                    </button>
                    <button class=" bg-blue-300 border border-black px-5 py-6 rounded"
                        onclick="window.location.href='/listFeedBack?page=0&size=' + document.getElementById('pageSize').value + '&star=4'">
                        4 Stars (50)
                    </button>
                    <button class="bg-blue-300 border border-black px-5 py-6 rounded"
                        onclick="window.location.href='/listFeedBack?page=0&size=' + document.getElementById('pageSize').value + '&star=3'">
                        3 Stars (50)
                    </button>
                    <button class="bg-blue-300 border border-black px-5 py-6 rounded"
                        onclick="window.location.href='/listFeedBack?page=0&size=' + document.getElementById('pageSize').value + '&star=2'">
                        2 Stars (0)
                    </button>
                    <button class=" bg-blue-300 border border-black px-5 py-6 rounded"
                        onclick="window.location.href='/listFeedBack?page=0&size=' + document.getElementById('pageSize').value + '&star=1'">
                        1 Star (0)
                    </button>
                </div>

            </div>


        </div>

        <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
            <!-- Ná»™i dung cho pháº§n tÃ¬m kiáº¿m -->
            <div id="searchContent" class="content">
                <div class="container-fluid">
                    <!-- Láº·p tá»«ng cáº·p booking: áº£nh vÃ  thÃ´ng tin -->
                    <div style="max-height: 700px; overflow-y: auto;">
                        <div th:each="DTO, iterStat : ${carBookingPages}" class="row mb-10">
                            <!-- Ã” áº£nh (Carousel) -->
                            <div
                                class="col-6 full-height bg-white d-flex flex-column align-items-center justify-content-center">
                                <div th:id="'carouselExampleCaptions_' + ${iterStat.index}" class="carousel slide">
                                    <!-- Indicators -->
                                    <div class="carousel-indicators">
                                        <button type="button"
                                            th:data-bs-target="'#carouselExampleCaptions_' + ${iterStat.index}"
                                            th:data-bs-slide-to="0" class="active" aria-current="true"
                                            aria-label="Slide 1"></button>
                                        <button type="button"
                                            th:data-bs-target="'#carouselExampleCaptions_' + ${iterStat.index}"
                                            th:data-bs-slide-to="1" aria-label="Slide 2"></button>
                                        <button type="button"
                                            th:data-bs-target="'#carouselExampleCaptions_' + ${iterStat.index}"
                                            th:data-bs-slide-to="2" aria-label="Slide 3"></button>
                                    </div>
                                    <!-- Slides -->
                                    <div class="carousel-inner">
                                        <div class="carousel-item active">
                                            <img th:src="${DTO.carBooking.Car.imageBack}" class="d-block w-100"
                                                alt="...">
                                        </div>
                                        <div class="carousel-item">
                                            <img th:src="${DTO.carBooking.Car.imageBack}" class="d-block w-100"
                                                alt="...">
                                        </div>
                                        <div class="carousel-item">
                                            <img th:src="${DTO.carBooking.Car.imageLeft}" class="d-block w-100"
                                                alt="...">
                                        </div>
                                    </div>
                                    <!-- Controls -->
                                    <button class="carousel-control-prev" type="button"
                                        th:data-bs-target="'#carouselExampleCaptions_' + ${iterStat.index}"
                                        data-bs-slide="prev">
                                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                    </button>
                                    <button class="carousel-control-next" type="button"
                                        th:data-bs-target="'#carouselExampleCaptions_' + ${iterStat.index}"
                                        data-bs-slide="next">
                                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                    </button>
                                </div>
                            </div>

                            <!-- Ã” thÃ´ng tin -->
                            <div
                                class="col-6 full-height bg-white border-white text-white d-flex align-items-center justify-content-center">
                                <div class="container w-100 h-100" style="margin-top: 0px">
                                    <table class="table w-100 h-100 text-2xl">
                                        <thead>
                                            <tr>
                                                <th colspan="2" scope="col"
                                                    class="text-center align-middle text-4xl text-black">
                                                    <span th:text="${DTO.carBooking.Car.name}">Nissan Navara
                                                        2017</span>
                                                </th>
                                                <th class="text-center font-bold bg-blue-600 text-white">
                                                    <button type="button" th:data-car-id="${DTO.carBooking.Car.id}"
                                                        onclick="handleRentNow(this)"
                                                        class="bg-green-500 text-white font-bold py-2 px-5 rounded-lg w-full">
                                                        Rent Now
                                                    </button>
                                                    <a id="rentNowLink" href="#" class="hidden"></a>
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr class="py-1" style="height: 50px;">
                                                <td class="font-bold text-left py-1" style="padding-top: 2px;">
                                                    Ratings
                                                </td>
                                                <td class="font-bold text-left py-1">
                                                    <div class="flex flex-col items-center">
                                                        <span class="text-3xl">
                                                            <span th:each="i : ${#numbers.sequence(1, 5)}"
                                                                th:classappend="${i <= DTO.feedback.rating} ? 'text-yellow-400' : 'text-gray-400'">
                                                                &#9733;
                                                            </span>


                                                        </span>

                                                    </div>
                                                </td>
                                                <td class="py-1">

                                                    <a class="d-block">
                                                        <button
                                                            class="bg-blue-500 text-white font-bold py-2 px-5 rounded-lg w-full">
                                                            <!-- Äáº·t width cho button -->
                                                            View Detail
                                                        </button>
                                                    </a>
                                                </td>

                                            </tr>


                                            <tr>
                                                <td class="font-bold text-left">No of rides</td>
                                                <td class="font-bold text-left"
                                                    th:text="${DTO.carBooking.Car.numOfSeats}">0
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="font-bold text-left">Price</td>
                                                <td class="font-bold text-left"
                                                    th:text="${DTO.carBooking.Car.basePrice}">
                                                    900k/day
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="font-bold text-left">Locations</td>
                                                <td class="font-bold text-left" th:text="${DTO.carBooking.Car.address}">
                                                    Cau
                                                    Giay,
                                                    Ha
                                                    Noi</td>
                                            </tr>
                                            <tr>
                                                <td class="font-bold  text-left">Status</td>
                                                <td class="text-blue-500 text-center text-left">
                                                    Available</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- HÃ ng 2 -->
                </div>
            </div>
        </div>



        <div class="card-footer p-3" th:if="${totalPages == 0}">
            <p class="text-center text-gray-700">No Car found</p>
        </div>
        <div class="card-footer pagination  flex justify-between items-center" th:if="${totalPages > 0} "
            style="padding: right 20px !important;padding-left: 20px!important;">
            <!-- Show select page size -->
            <div class="flex justify-between items-center">
                <div>
                    <label for="pageSize" class="block text-sm font-medium text-gray-700 mb-2">Page Size:</label>
                    <select id="pageSize" name="pageSize" class="p-2 border border-slate-300 rounded-md"
                        onchange="window.location.href='/listFeedBack?page=0&size=' + this.value;">
                        <option th:each="size : ${pageSizes}" th:value="${size}" th:text="${size}"
                            th:selected="${size == pageSize}"></option>
                    </select>

                </div>
            </div>
            <ul class="pagination-step flex justify-center items-center gap-2">
                <!-- Previous Page -->
                <li>
                    <a class="p-3" th:href="@{/listFeedBack(page=${currentPage - 1}, size=${pageSize})}"
                        th:classappend="${currentPage == 0} ? 'pointer-events-none text-slate-300' : ''">
                        <i class="fa-solid fa-angle-left"></i>
                    </a>
                </li>

                <!-- Page Numbers -->
                <li th:each="pageNum : ${#numbers.sequence(0, totalPages - 1 < 0 ? 0 : totalPages - 1)}">
                    <a class="p-3"
                        th:href="@{/listFeedBack(sort=${sort}, order=${order}, page=${pageNum}, size=${pageSize})}"
                        th:classappend="${pageNum == currentPage} ? 'inline-block text-center bg-blue-700 rounded-full w-12 h-12 text-white' : ''">
                        <span th:text="${pageNum + 1}"></span>
                    </a>
                </li>

                <!-- Next Page - Disabled if currentPage is the last page -->
                <li>
                    <a class="p-3"
                        th:href="@{/listFeedBack(sort=${sort}, order=${order}, page=${currentPage + 1}, size=${pageSize})}"
                        th:classappend="${currentPage == totalPages - 1} ? 'pointer-events-none text-slate-300' : ''">
                        <i class="fa-solid fa-angle-right"></i>
                    </a>
                </li>
            </ul>

            <!-- Show item 0-100 of 1000 -->
            <div class="flex justify-center items-center gap-2">
                <span class="text-sm text-gray-700"
                    th:text="|Show ${currentPage * pageSize + 1}-${(currentPage + 1) * pageSize} of ${totalElements}|">
                </span>
            </div>
        </div>


        <script>
            document.addEventListener("DOMContentLoaded", function () {
                let ratingValue = parseFloat(document.getElementById('rating-value').innerText);
                updateStars(ratingValue);
            });

            function updateStars(rating) {
                let roundedRating = Math.round(rating);
                let stars = document.querySelectorAll('.star');

                stars.forEach(star => {
                    if (parseInt(star.getAttribute('data-value')) <= roundedRating) {
                        star.classList.add('filled');
                    } else {
                        star.classList.remove('filled');
                    }
                });
            }
        </script>

    </section>
</body>

</html>